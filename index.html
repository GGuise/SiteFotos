<!DOCTYPE html>

<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Voos Guise - Sua Galeria de Viagens 360°</title>

    <!-- Tailwind (para estilização rápida) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dot-prop@5/dist/index.min.js"></script>

    <!-- Dependências do Photo Sphere Viewer -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.140.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uevent@2/browser.js"></script>

    <!-- Biblioteca Photo Sphere Viewer v4 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photo-sphere-viewer@4/dist/photo-sphere-viewer.min.css">
    <script src="https://cdn.jsdelivr.net/npm/photo-sphere-viewer@4/dist/photo-sphere-viewer.min.js"></script>

    <!-- Plugin para ativar o Giroscópio -->
    <script src="https://cdn.jsdelivr.net/npm/photo-sphere-viewer@4/dist/plugins/gyroscope.min.js"></script>

    <style>
        /* Força o visualizador a ocupar a viewport e ficar acima do restante da página,
           evitando que o zoom/transform da página esconda os controles.
           Mantemos também compatibilidade com a estrutura do PhotoSphereViewer. */
        #photoSphereViewer {
            position: fixed;
            inset: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            background: black;
            -webkit-tap-highlight-color: transparent;
            touch-action: none; /* evita comportamento inesperado de gestos sobre o viewer */
        }

        /* Contêiner do visualizador 360°: Ocupa toda a tela */
        .psv-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        /* Garante que a navbar do viewer fique visível e em cima de tudo */
        .psv-navbar {
            position: absolute !important;
            top: 12px !important;
            right: 12px !important;
            left: auto !important;
            bottom: auto !important;
            z-index: 10001 !important;
            transform: none !important;
            pointer-events: auto !important;
        }

        /* Botões do navbar sempre clicáveis e acima */
        .psv-navbar .psv-button {
            z-index: 10002 !important;
        }

        /* Transição para as miniaturas da galeria */
        .gallery-thumb {
            transition: all 0.3s ease;
        }

        /* Efeito de hover nas miniaturas (aumenta e adiciona sombra) */
        .gallery-thumb:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Estilização da barra de rolagem da barra lateral (para Firefox) */
        .sidebar {
            scrollbar-width: thin;
            scrollbar-color: #4f46e5 #e5e7eb;
        }

        /* Estilização da barra de rolagem da barra lateral (para Webkit/Chrome/Safari) */
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: #e5e7eb;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background-color: #4f46e5;
            border-radius: 6px;
        }

        /* Responsividade: Oculta a barra lateral em telas pequenas por padrão */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            /* Mostra a barra lateral quando a classe 'open' é aplicada via JS */
            .sidebar.open {
                transform: translateX(0);
            }
        }
    </style>
</head>

<body class="bg-gray-50 font-sans relative">
    <div class="flex h-screen">
        <div
            class="sidebar bg-white w-64 md:w-80 border-r border-gray-200 flex flex-col overflow-y-auto absolute md:relative z-20 h-full">
            <div class="p-4 border-b border-gray-200">
                <h1 class="text-xl font-bold text-indigo-600">Voos Guise</h1>
                <p class="text-sm text-gray-500">Minha Coleção de Viagens 360°</p>
            </div>

            <div class="p-4">
                <div class="relative">
                    <input type="text" id="citySearch" placeholder="Buscar cidades..."
                        class="w-full pl-8 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    <i data-feather="search" class="absolute left-3 top-3 text-gray-400"></i>
                </div>
            </div>

            <!-- Lista de cidades -->
            <div class="flex-1 overflow-y-auto">
                <div class="space-y-1 px-2">
                    <button
                        class="city-btn w-full text-left px-3 py-2 rounded-lg hover:bg-indigo-50 flex items-center justify-between"
                        data-city="cambira">
                        <span>Cambira, Paraná</span>
                        <i data-feather="chevron-right" class="text-gray-400"></i>
                    </button>

                    <button
                        class="city-btn w-full text-left px-3 py-2 rounded-lg hover:bg-indigo-50 flex items-center justify-between"
                        data-city="santa_fe">
                        <span>Santa Fé do Sul, São Paulo</span>
                        <i data-feather="chevron-right" class="text-gray-400"></i>
                    </button>


                    <button
                        class="city-btn w-full text-left px-3 py-2 rounded-lg hover:bg-indigo-50 flex items-center justify-between"
                        data-city="tborba">
                        <span>Telêmaco Borba, Paraná</span>
                        <i data-feather="chevron-right" class="text-gray-400"></i>
                    </button>

                    <button
                        class="city-btn w-full text-left px-2 py-2 rounded-lg hover:bg-indigo-50 flex items-center justify-between"
                        data-city="cgrande">
                        <span>Campo Grande, Mato Grosso do Sul</span>
                        <i data-feather="chevron-right" class="text-gray-400"></i>
                    </button>
                    
                    <button class="city-btn w-full text-left px-3 py-2 rounded-lg hover:bg-indigo-50 flex items-center justify-between" data-city="cwb">
                        <span>Curitiba, Paraná</span>
                        <i data-feather="chevron-right" class="text-gray-400"></i>
                    </button>
                    <!--
                    <button class="city-btn w-full text-left px-3 py-2 rounded-lg hover:bg-indigo-50 flex items-center justify-between" data-city="cape-town">
                        <span>Cidade do Cabo, África do Sul</span>
                        <i data-feather="chevron-right" class="text-gray-400"></i>
                    </button>

                    -->
                </div>
            </div>

            <!-- Perfil do Usuário -->
            <div class="p-4 border-t border-gray-200">
                <div class="flex items-center space-x-2">
                    <img src="assets/VoosGuiseLogo.png" class="w-10 h-10 rounded-full" alt="Perfil">
                    <div>
                        <p class="text-sm font-medium">Seu Perfil de Viagem</p>
                        <a href="#" class="text-xs text-indigo-600">Ver Conta</a>
                    </div>
                </div>
            </div>
        </div>

        <button id="sidebarToggle" class="md:hidden fixed top-4 left-4 z-30 bg-white p-2 rounded-full shadow-md">
            <i data-feather="menu"></i>
        </button>

        <div id="mainContent" class="flex-1 flex flex-col overflow-y-auto bg-gray-100">
            <div id="welcomeSection" class="min-h-screen flex flex-col items-center justify-center p-8 text-center">
                <div class="max-w-2xl mx-auto">
                    <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-6">Bem-vindo ao Meu Mundo 360°</h1>
                    <p class="text-lg text-gray-600 mb-8">Explore minha coleção de fotos imersivas 360°, cada dia sendo mais atualizado. Selecione uma cidade na barra lateral para iniciar sua jornada virtual.</p>
                    <div class="flex justify-center space-x-4">

                        <button id="exploreBtn"
                            class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                            <i data-feather="compass" class="inline mr-2"></i> Explorar Galeria
                        </button>

                        <button id="aboutBtn"
                            class="px-6 py-3 border border-indigo-600 text-indigo-600 rounded-lg hover:bg-indigo-50 transition">
                            <i data-feather="user" class="inline mr-2"></i> Sobre Mim
                        </button>
                    </div>
                </div>
            </div>

            <!-- Galeria de Imagens -->
            <div id="previewGallery" class="mt-12 grid grid-cols-2 md:grid-cols-3 gap-3 max-w-4xl mx-auto px-4 pb-8 hidden" style="display: none; min-height: 400px;">

                <div class="preview-thumb relative bg-gray-200 rounded-xl overflow-hidden cursor-pointer hover:scale-105 transition-transform" style="height: 128px;" data-image="assets/Cambira.jpg" data-title="Cambira - PR">
                    <img src="assets/Cambira.jpg" class="w-full h-full object-cover" alt="Cambira - PR">
                    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-3">
                        <span class="text-white font-medium">Cambira - PR</span>
                    </div>
                </div>

                <div class="preview-thumb relative bg-gray-200 rounded-xl overflow-hidden cursor-pointer hover:scale-105 transition-transform" style="height: 128px;" data-image="assets/SantaFedoSul1.jpg" data-title="Santa Fé do Sul - SP">
                    <img src="assets/SantaFedoSul1.jpg" class="w-full h-full object-cover" alt="Santa Fé do Sul - SP">
                    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-3">
                        <span class="text-white font-medium">Santa Fé do Sul - SP</span>
                    </div>
                </div>

                <div class="preview-thumb relative bg-gray-200 rounded-xl overflow-hidden cursor-pointer hover:scale-105 transition-transform" style="height: 128px;" data-image="assets/TelemacoBorba1.09.08.25.jpg" data-title="Telêmaco Borba - PR">
                    <img src="assets/TelemacoBorba1.09.08.25.jpg" class="w-full h-full object-cover" alt="Telêmaco Borba - PR">
                    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-3">
                        <span class="text-white font-medium">Telêmaco Borba - PR</span>
                    </div>
                </div>

                <div class="preview-thumb relative bg-gray-200 rounded-xl overflow-hidden cursor-pointer hover:scale-105 transition-transform" style="height: 128px;" data-image="assets/cgrande1.20.09.25.jpg" data-title="Campo Grande - MS">
                    <img src="assets/cgrande1.20.09.25.jpg" class="w-full h-full object-cover" alt="Campo Grande - MS">
                    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-3">
                        <span class="text-white font-medium">Campo Grande - MS</span>
                    </div>
                </div>
            </div>

            <div id="gallerySection" class="hidden flex-1 p-6">
                <div class="mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h2 id="galleryCity" class="text-2xl font-bold text-gray-800">Galeria da Cidade</h2>
                            <p id="gallerySubtitle" class="text-gray-600">Selecione uma foto para ver em 360°</p>
                        </div>
                        <button id="backToHomeFromGallery" 
                            class="px-4 py-2 border border-indigo-600 text-indigo-600 rounded-lg hover:bg-indigo-50 transition">
                            <i class="inline mr-2"></i> Voltar ao Início
                            <!--<i data-feather="arrow-left" class="inline mr-2"></i> Voltar ao Início-->
                        </button>
                    </div>
                </div>
                <div id="photoGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                </div>
            </div>

            <!-- SOBRE MIM -->
            <div id="aboutSection" class="hidden flex-1 flex flex-col items-center justify-center p-8 text-center">
                <div class="max-w-2xl mx-auto">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">Sobre Mim</h2>
                    <p class="text-gray-600 mb-6 leading-relaxed">
                        Olá! Sou apaixonado por capturar o mundo em 360°, explorando paisagens, cidades e eventos sob
                        uma nova
                        perspectiva. Cada imagem nesta galeria foi registrada com carinho para transmitir a sensação de
                        estar
                        presente em cada lugar.
                    </p>
                    <button id="backToHome"
                        class="px-6 py-3 border border-indigo-600 text-indigo-600 rounded-lg hover:bg-indigo-50 transition">
                        <!--<i data-feather="arrow-left" class="inline mr-2"></i> Voltar ao Início-->
                        <i class="inline mr-2"></i> Voltar ao Início
                    </button>
                </div>
            </div>


            <div id="photoSphereViewer" class="hidden h-screen w-full"></div>
        </div>
    </div>


    <script>


        document.addEventListener('DOMContentLoaded', function () {
            // Inicializa os ícones Feather
            feather.replace();

            // Dados de amostra para fotos 360° (em uma aplicação real, viriam de uma API)
            // As chaves são mantidas em inglês para corresponder ao data-city do HTML.
            // local para alterar o endereçamento do url das imagens

            const photoData = {
                cambira: [
                    { id: 'cambira1', title: 'EXPOCAM 18.10.25', url: 'assets/Cambira171025.jpg' },
                    { id: 'cambira2', title: 'EXPOCAM 19.10.25', url: 'assets/CambiraExpocam19.jpg' },
                    /* inserir mais fotos aqui
                    { id: 'paris3', title: 'Ruas de Montmartre', url: 'https://photo-sphere-viewer-data.netlify.app/assets/sphere.jpg'
                    },
                    { id: 'paris4', title: 'Rio Sena', url: 'https://photo-sphere-viewer-data.netlify.app/assets/sphere.jpg' }
                    */
                ],

                santa_fe: [
                    { id: 'santa_fe1', title: 'Praça das Arraras - 17.09.2025', url: 'assets/SantaFedoSul170925.jpg' },
                    { id: 'santa_fe2', title: 'Igreja Matriz - 17.09.2025', url: 'assets/SantaFedoSul170925Igreja.jpg' },
                    { id: 'santa_fe3', title: 'Praça - 17.09.2025', url: 'assets/SantaFedoSulPraca.jpg' },
                    { id: 'santa_fe4', title: 'Parque Águas Clara - 17.09.2025', url: 'assets/SantaFedoSul1.jpg' }
                ],

                tborba: [
                    { id: 'tborba1', title: 'Festa "Agostina" - 09.08.2025', url: 'assets/TelemacoBorba1.09.08.25.jpg' },
                    { id: 'tborba2', title: 'Festa "Agostina" - 09.08.2025', url: 'assets/TelemacoBorba2.09.08.25.jpg' },
                    { id: 'tborba3', title: 'Entrega convites do Casamento - 14.09.2025', url: 'assets/tborba14.09.2025.jpg' },
                    { id: 'tborba4', title: '22.09.2025', url: 'assets/tborba1.22.03.2024-pano.jpg' },
                    { id: 'tborba5', title: '31.03.2024', url: 'assets/tborbacasa31.03.2024.jpg' },
                    { id: 'tborba6', title: 'Aniversário Joaquim - 30.03.2024', url: 'assets/tborbaJoaquim1.30.03.2024.jpg' },
                    { id: 'tborba7', title: 'Aniversário Joaquim - 30.03.2024', url: 'assets/tborbaJoaquim2.30.03.2024.jpg' }

                    //{ id: 'ny4', title: 'Ponte do Brooklyn', url: 'https://photo-sphere-viewer-data.netlify.app/assets/sphere.jpg' }

                ],

                cgrande: [
                    { id: 'cgrande', title: 'Confraternização - 20.09.2025', url: 'assets/cgrande1.20.09.25.jpg' },
                    { id: 'cgrande', title: 'Confraternização - 20.09.2025', url: 'assets/cgrande2.20.09.25.jpg' },
                    /*{ id: 'cgrande', title: 'Praia de Copacabana', url:
                    'https://photo-sphere-viewer-data.netlify.app/assets/sphere.jpg' }*/
                ],
                
                cwb: [
                { id: 'cbw1', title: 'Shopping Palladium - dia 13.03.2024', url: 'assets/cwbPalladium3.jpg' },
                { id: 'cbw2', title: 'Shopping Palladium - Noite 13.03.2024', url: 'assets/cwbPalladium1.13.03.2024-pano.jpg' },
                { id: 'cbw3', title: 'Shopping Palladium - Noite 13.03.2024', url: 'assets/cwbPalladium2.13.03.2024-pano.jpg' },
                { id: 'cbw4', title: 'Colombo - 25.02.2024', url: 'assets/colombo25.02.2024.jpg' }
                ],

                /* Exemplos adicionais para futuras cidades
                'cape-town': [
                { id: 'ct1', title: 'Table Mountain', url: 'https://photo-sphere-viewer-data.netlify.app/assets/sphere.jpg' },
                { id: 'ct2', title: 'Cabo da Boa Esperança', url: 'https://photo-sphere-viewer-data.netlify.app/assets/sphere.jpg' }
                ]
            
                */
            };

            // Nomes de cidades para exibição (traduzidos)
            const cityNames = {
                cambira: 'Cambira, Paraná',
                santa_fe: 'Santa Fé do Sul, São Paulo',
                tborba: 'Telêmaco Borba, Paraná',
                cgrande: 'Campo Grande, Mato Grosso do Sul',
                cwb: 'Curitiba, Paraná',
                cape_town: 'Cidade do Cabo, África do Sul'
            };


            // Elementos DOM
            const welcomeSection = document.getElementById('welcomeSection');
            const gallerySection = document.getElementById('gallerySection');
            const photoGrid = document.getElementById('photoGrid');
            const galleryCity = document.getElementById('galleryCity');
            const gallerySubtitle = document.getElementById('gallerySubtitle');
            const photoSphereViewer = document.getElementById('photoSphereViewer');
            const cityButtons = document.querySelectorAll('.city-btn');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const sidebar = document.querySelector('.sidebar');
            const citySearch = document.getElementById('citySearch');

            // 🔹 NOVOS ELEMENTOS ADICIONADOS
            const aboutSection = document.getElementById('aboutSection');
            const backToHomeBtn = document.getElementById('backToHome');
            const backToHomeFromGalleryBtn = document.getElementById('backToHomeFromGallery');
            const exploreBtn = document.getElementById('exploreBtn');
            const aboutBtn = document.getElementById('aboutBtn');
            const previewGallery = document.getElementById('previewGallery');

            // Variável para rastrear de onde o usuário veio
            let currentViewSource = 'gallery'; // 'gallery' ou 'preview'


            // --- OUVINTES DE EVENTO ---

            // Funcionalidade de Busca
            citySearch.addEventListener('input', function () {
                const searchTerm = this.value.toLowerCase();
                cityButtons.forEach(button => {
                    // Busca pelo texto do botão (o nome da cidade traduzido)
                    const cityName = button.textContent.toLowerCase();
                    if (cityName.includes(searchTerm)) {
                        button.style.display = 'flex';
                    } else {
                        button.style.display = 'none';
                    }
                });
            });

            // Alternar barra lateral móvel
            sidebarToggle.addEventListener('click', function () {
                sidebar.classList.toggle('open');
            });

            // Handler de clique do botão da cidade
            cityButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const city = this.dataset.city; // Pega a chave (ex: 'rio')
                    loadCityGallery(city);
                    // Oculta a barra lateral no mobile após a seleção
                    sidebar.classList.remove('open');
                });
            });



            // 🔹 NOVA FUNCIONALIDADE DOS BOTÕES (INÍCIO)

            // Botão "Explorar Galeria"
            console.log('Verificando elementos DOM:');
            console.log('exploreBtn:', exploreBtn);
            console.log('previewGallery:', previewGallery);
            
            if (exploreBtn && previewGallery) { 
                console.log('Elementos encontrados! Adicionando listener...');
                exploreBtn.addEventListener('click', function () {
                    console.log('Botão Explorar Galeria clicado!');
                    
                    // 1. Mostra a galeria - remove tanto a classe hidden quanto o display none
                    previewGallery.classList.remove('hidden');
                    previewGallery.style.display = 'grid'; // Força o display grid
                    previewGallery.style.minHeight = '400px'; // Garante altura mínima
                    previewGallery.style.backgroundColor = '#f9fafb'; // Fundo temporário para debug
                    console.log('Galeria de preview mostrada');
                    console.log('Classes da galeria:', previewGallery.className);
                    console.log('Style display:', previewGallery.style.display);
                    console.log('Posição da galeria:', previewGallery.getBoundingClientRect());
                    
                    // Verificar se as imagens estão sendo carregadas
                    const images = previewGallery.querySelectorAll('img');
                    console.log('Número de imagens encontradas:', images.length);
                    images.forEach((img, index) => {
                        console.log(`Imagem ${index + 1}:`, img.src, 'Altura:', img.height, 'Largura:', img.width);
                    });
                    
                    // 2. Rola suavemente para a galeria
                    setTimeout(() => { 
                        previewGallery.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                        console.log('Scroll executado para a galeria');
                        
                        // Remove o fundo de debug após 2 segundos
                        setTimeout(() => {
                            previewGallery.style.backgroundColor = '';
                        }, 2000);
                    }, 100);
                });
                console.log('Listener adicionado com sucesso!');
            } else {
                console.error('ERRO: Elementos não encontrados!');
                console.error('exploreBtn:', exploreBtn);
                console.error('previewGallery:', previewGallery);
            }


            // Botão "Sobre Mim"
            if (aboutBtn && welcomeSection && aboutSection) {
                aboutBtn.addEventListener('click', function () {
                    welcomeSection.classList.add('hidden');
                    previewGallery.classList.add('hidden'); // Oculta a galeria de preview
                    previewGallery.style.display = 'none'; // Força o display none
                    aboutSection.classList.remove('hidden');
                });
            }

            // Botão "Voltar ao Início" (que está na seção Sobre Mim)
            if (backToHomeBtn && welcomeSection && aboutSection) {
                console.log('Configurando botão Voltar ao Início da seção Sobre...');
                backToHomeBtn.addEventListener('click', function () {
                    console.log('Botão Voltar ao Início clicado!');
                    aboutSection.classList.add('hidden');
                    previewGallery.classList.add('hidden'); // Oculta a galeria de preview
                    previewGallery.style.display = 'none'; // Força o display none
                    welcomeSection.classList.remove('hidden');
                });
            } else {
                console.error('Elementos não encontrados para botão Voltar ao Início:', {
                    backToHomeBtn: backToHomeBtn,
                    welcomeSection: welcomeSection,
                    aboutSection: aboutSection
                });
            }

            // Botão "Voltar ao Início" (que está na galeria de cidades)
            if (backToHomeFromGalleryBtn && welcomeSection && gallerySection) {
                console.log('Configurando botão Voltar ao Início da galeria...');
                backToHomeFromGalleryBtn.addEventListener('click', function () {
                    console.log('Botão Voltar ao Início da galeria clicado!');
                    gallerySection.classList.add('hidden');
                    previewGallery.classList.add('hidden'); // Oculta a galeria de preview
                    previewGallery.style.display = 'none'; // Força o display none
                    welcomeSection.classList.remove('hidden');
                });
            } else {
                console.error('Elementos não encontrados para botão Voltar ao Início da galeria:', {
                    backToHomeFromGalleryBtn: backToHomeFromGalleryBtn,
                    welcomeSection: welcomeSection,
                    gallerySection: gallerySection
                });
            }

            // Event listeners para as miniaturas da galeria de preview
            console.log('Configurando event listeners para miniaturas de preview...');
            const previewThumbs = document.querySelectorAll('.preview-thumb');
            console.log('Miniaturas encontradas:', previewThumbs.length);
            
            if (previewThumbs.length > 0) {
                previewThumbs.forEach((thumb, index) => {
                    console.log(`Configurando listener para miniatura ${index + 1}:`, thumb);
                    thumb.addEventListener('click', function () {
                        const imageUrl = this.dataset.image;
                        const imageTitle = this.dataset.title;
                        
                        console.log('Miniatura clicada:', imageTitle, imageUrl);
                        console.log('Elementos DOM:', {
                            previewGallery: previewGallery,
                            welcomeSection: welcomeSection,
                            photoSphereViewer: photoSphereViewer
                        });
                        
                        // Define que veio da galeria de preview
                        currentViewSource = 'preview';
                        
                        // Oculta a galeria de preview e mostra o visualizador 360°
                        previewGallery.classList.add('hidden');
                        previewGallery.style.display = 'none';
                        welcomeSection.classList.add('hidden');
                        photoSphereViewer.classList.remove('hidden');
                        
                        console.log('Tentando abrir visualizador 360°...');
                        // Abre o visualizador 360°
                        openPhotoSphereViewer(imageUrl, imageTitle);
                    });
                });
                console.log('Event listeners das miniaturas configurados com sucesso!');
            } else {
                console.error('Nenhuma miniatura encontrada!');
            }





            // Carregar Galeria da Cidade
            function loadCityGallery(city) {
                // Define que veio da galeria de cidade
                currentViewSource = 'gallery';
                
                // Mostra a seção da galeria e oculta as outras
                welcomeSection.classList.add('hidden');
                aboutSection.classList.add('hidden'); // Garante que a seção "Sobre" também seja ocultada
                previewGallery.classList.add('hidden'); // Oculta a galeria de preview
                previewGallery.style.display = 'none'; // Força o display none
                gallerySection.classList.remove('hidden');
                photoSphereViewer.classList.add('hidden');

                // Define o título da cidade
                galleryCity.textContent = cityNames[city];

                // Texto do subtítulo traduzido
                gallerySubtitle.textContent = `${photoData[city].length} fotos imersivas 360°`;

                // Limpa as fotos existentes
                photoGrid.innerHTML = '';

                // Adiciona fotos à grade
                photoData[city].forEach(photo => {
                    const photoElement = document.createElement('div');
                    // Classe para o efeito de hover
                    photoElement.className = 'gallery-thumb bg-white rounded-lg overflow-hidden shadow-md cursor-pointer';
                    photoElement.innerHTML = `
                        <div class="relative aspect-square">
                            <img src="${photo.url}" class="w-full h-full object-cover" alt="${photo.title}">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent flex items-end p-3">
                                <span class="text-white font-medium">${photo.title}</span>
                            </div>
                        </div>
                        `;
                    // Adiciona o ouvinte de evento para abrir o visualizador 360°
                    photoElement.addEventListener('click', () => {
                        openPhotoSphereViewer(photo.url, photo.title);
                    });
                    photoGrid.appendChild(photoElement);
                });
            }

            // Abrir Visualizador de Fotos 360°
            function openPhotoSphereViewer(imageUrl, title) {
                console.log('openPhotoSphereViewer chamada com:', imageUrl, title);
                console.log('Elementos disponíveis:', {
                    gallerySection: gallerySection,
                    photoSphereViewer: photoSphereViewer,
                    currentViewSource: currentViewSource
                });
                
                gallerySection.classList.add('hidden');
                photoSphereViewer.classList.remove('hidden');

                // Função utilitária para localizar botão no DOM do viewer
                function findNavbarButton(id) {
                    try {
                        return photoSphereViewer.querySelector('.psv-navbar .psv-button[data-id="' + id + '"]');
                    } catch (e) {
                        return null;
                    }
                }

                // Função que pede permissão (iOS) se necessário, retorna Promise
                function requestDeviceOrientationPermissionIfNeeded() {
                    if (typeof DeviceOrientationEvent !== 'undefined' &&
                        typeof DeviceOrientationEvent.requestPermission === 'function') {
                        return DeviceOrientationEvent.requestPermission();
                    }
                    return Promise.resolve('granted');
                }

                // Inicializa ou atualiza o Photo Sphere Viewer
                if (window.viewer) {
                    viewer.setPanorama(imageUrl);
                    viewer.setCaption(title);
                    // Atualiza ícones (caso o panorama troque)
                    feather.replace();
                } else {
                    window.viewer = new PhotoSphereViewer.Viewer({
                        container: photoSphereViewer,
                        panorama: imageUrl,
                        caption: title,
                        loadingImg: 'https://photo-sphere-viewer.js.org/assets/photosphere-logo.gif',

                        // Ativa o plugin de giroscópio (sem iniciar automaticamente)
                        plugins: [
                            [PhotoSphereViewer.GyroscopePlugin, { touchmove: true }]
                        ],

                        // Barra de navegação com botões personalizados
                        navbar: [
                            'zoom',
                            'move',
                            'download',
                            'fullscreen',
                            {
                                id: 'gyro',
                                title: 'Ativar/Desativar Giroscópio',
                                className: 'custom-button',
                                content: '<i data-feather="compass"></i>'
                                // onClick será tratado após o viewer estar pronto para garantir acesso ao DOM
                            },
                            {
                                id: 'back',
                                title: 'Voltar',
                                className: 'custom-button',
                                content: '<i data-feather="arrow-left"></i>'
                                // onClick será tratado após o viewer estar pronto
                            }
                        ],

                        defaultZoomLvl: 50,
                        // força o viewer a usar a viewport real (não herdar transform/zoom do pai)
                        size: {
                            width: '100vw',
                            height: '100vh'
                        }
                    });

                    // Quando o viewer estiver pronto, conectamos os handlers que precisam de DOM / permissão
                    viewer.once('ready', () => {
                        // Renderiza os ícones Feather dentro do navbar
                        feather.replace();

                        // tenta obter botões via API do viewer; se não existir, cai no querySelector
                        const getButton = (id) => {
                            try {
                                if (viewer && viewer.navbar && typeof viewer.navbar.getButton === 'function') {
                                    const btn = viewer.navbar.getButton(id);
                                    // Se já for um elemento DOM, retorna direto
                                    if (btn instanceof HTMLElement) return btn;
                                    // Se for um objeto, tenta extrair a referência ao elemento
                                    if (btn && (btn.el || btn.element || btn.node || btn.container || btn.dom)) {
                                        return btn.el || btn.element || btn.node || btn.container || btn.dom;
                                    }
                                }
                            } catch (e) { /* ignore */ }
                            // fallback para buscar pelo DOM dentro do container do viewer
                            return findNavbarButton(id);
                        };

                        const gyroBtn = getButton('gyro');
                        const backBtn = getButton('back');

                        // utilitário para anexar handler que funcione em desktop e mobile (click + touchend)
                        const attachTap = (rawEl, handler) => {
                            if (!rawEl) return;
                            // Normaliza o elemento para garantir que é um HTMLElement
                            const el = (rawEl instanceof HTMLElement) ? rawEl
                                : (rawEl && (rawEl.el || rawEl.element || rawEl.node || rawEl.container || rawEl.dom));
                            if (!el || typeof el.addEventListener !== 'function') {
                                console.warn('attachTap: elemento inválido para botão', rawEl, el);
                                return;
                            }
                            let busy = false;
                            el.addEventListener('click', (e) => {
                                if (busy) return;
                                busy = true;
                                try { handler(e); } finally { setTimeout(() => busy = false, 300); }
                            });
                            el.addEventListener('touchend', (e) => {
                                if (busy) return;
                                busy = true;
                                try { handler(e); } finally { setTimeout(() => busy = false, 300); }
                                e.preventDefault();
                            }, { passive: false });
                        };

                        // Handler para alternar giroscópio com pedido de permissão se necessário
                        if (gyroBtn) {
                            attachTap(gyroBtn, () => {
                                const gyroPlugin = viewer.getPlugin(PhotoSphereViewer.GyroscopePlugin);
                                if (!gyroPlugin) return;

                                requestDeviceOrientationPermissionIfNeeded()
                                    .then(response => {
                                        if (response === 'denied') {
                                            alert('Permissão de giroscópio negada.');
                                            return;
                                        }
                                        if (gyroPlugin.isEnabled && gyroPlugin.isEnabled()) {
                                            gyroPlugin.stop().then(() => {
                                                gyroBtn.classList.remove('psv-button--active');
                                            }).catch(() => {
                                                console.warn('Erro ao parar o giroscópio.');
                                            });
                                        } else {
                                            gyroPlugin.start().then(() => {
                                                gyroBtn.classList.add('psv-button--active');
                                            }).catch((err) => {
                                                console.warn('Não foi possível iniciar o giroscópio:', err);
                                                alert('⚠️ Permissão de giroscópio negada ou não suportada neste dispositivo.');
                                            });
                                        }
                                    })
                                    .catch(err => {
                                        console.warn('requestDeviceOrientationPermissionIfNeeded erro:', err);
                                        alert('⚠️ Não foi possível obter permissão de giroscópio.');
                                    });
                            });
                        }

                        // Handler do botão Voltar
                        if (backBtn) {
                            attachTap(backBtn, () => {
                                photoSphereViewer.classList.add('hidden');
                                
                                if (currentViewSource === 'preview') {
                                    // Volta para a tela inicial
                                    welcomeSection.classList.remove('hidden');
                                    previewGallery.classList.remove('hidden');
                                    previewGallery.style.display = 'grid';
                                } else {
                                    // Volta para a galeria da cidade
                                    gallerySection.classList.remove('hidden');
                                }

                                // remove estado visual do botão gyro
                                const g = getButton('gyro');
                                if (g) g.classList.remove('psv-button--active');

                                // re-renderiza icons
                                feather.replace();
                            });
                        }

                        // Tenta iniciar o giroscópio automaticamente (não obrigatório)
                        const gyroPlugin = viewer.getPlugin(PhotoSphereViewer.GyroscopePlugin);
                        if (gyroPlugin) {
                            // Não chame start() automaticamente em mobile sem gesto; aqui apenas tenta sem pedir permissão.
                            gyroPlugin.start().then(() => {
                                const g = getButton('gyro');
                                if (g) g.classList.add('psv-button--active');
                            }).catch(() => {
                                // normal: permissões não concedidas ou não suportado
                                console.warn('Permissão de giroscópio negada ou não suportada.');
                            });
                        }
                    });
                }
            }


        });
    </script>
</body>

</html>